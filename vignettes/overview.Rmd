---
title: "Overview of using SBIC for network models"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(SBIC)
library(network) # for visualization 

comparison=function(real, estimate){
  ## M1 is the true net matrix
  ##Me is the estimated net matrix
  real=real+t(real)
  diag(real)=1
  estimate=estimate+t(estimate)
  diag(estimate)=1
  N1=ifelse(real==0,0,1)
  N2=ifelse(estimate==0,0,1)
   if (any(dim(N1)!=dim(N2))[1])
  stop("Two matrixes should have the same dimension")
  p=dim(real)[1]
  real=(sum(N1)-p)/2
  select=(sum(N2)-p)/2
  real_select=(sum(N2[N1==1])-p)/2
  fause_select=sum(N2[N1==0])/2
  if (real==0){return( list(PSR=1, FDR=0))}
  if (select==0) {return(list(PSR=0, FDR=0))}
  PSR=real_select/real
  FDR=fause_select/select
    return(list(PSR=PSR, FDR=FDR))
}
```
The function `comparison` allows for comparison between the true network and the estimated network from the SBIC method.  

First we create a simulated data set using the embedded `simulate` function within SBIC. The function `simulate` generates a data frame, a real network adjacency matrix and a prior network adjacency matrix.  
```{r simulate_data}
prob1=0.02
prob2=0.02
p=100
a=simulate(p=p, n=500, prob1 = prob1, prob2 = prob2, ka=50)
data=a$data
real=a$realnetwork
priori=a$priornetwork
```
We can visualize the networks  
```{r visualize_networks}
prior_net <- network(priori)
real_net <- network(real)
par(mfrow = c(1,2))
plot(prior_net, main = "Prior network")
plot(real_net, main = "Real network")
```

We examine some features of both the prior network and the real network 
```{r examining_networks}
sum(priori[lower.tri(priori)])
sum(priori[lower.tri(priori)])/(p*(p-1)/2)
sum(real[lower.tri(real)])
sum(real[lower.tri(real)])/(p*(p-1)/2)
```

Then we can fit SBIC using one function
```{r fit_models}
lambda=exp(seq(-10,10, length=30))
model=sGGM(data = data, lambda = lambda, M=priori, prob = prob2)
```
Comparing the estimated network to the true and prior network. Our comparison function above calcualtes the Positive selection rate (PSR) and the False positive rate (FDR)
```{r}
print("Comparing estimated model with the real network")
comparison(real = real, estimate = model$estimate)
print("Comparing the prior network with the real network")
comparison(real = real, estimate = priori)
```
We can also compare visualizations 
```{r}
estimated_net <- network(model$estimate)
par(mfrow = c(1,3))
plot(prior_net, main = "Prior Network")
plot(real_net, main = "Real Network")
plot(estimated_net, main = "Estimated Network")
```


The model object also stores all the candidate models generated.  
```{r}
length(model$candidate)
```
